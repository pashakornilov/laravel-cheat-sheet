# laravel-cheat-sheet

## Route

	Пример: http://example.com/articles

### Define route

```php
// Регистрация GET-маршрута с использованием замыкания
Route::get('/articles', function(){});

// Регистрация GET-маршрута с использованием контроллера
Route::get('/articles', 'ArticleController@index');
Route::get('/articles', [ArticleController::class, 'index']);
```

### Route Parameter

```php
// Передача числового ID статьи в переменную $id.
Route::get('/articles/{article}', function ($id) {return 'article '. $id;});

// Передача числового ID статьи в переменную $articleId, ID комментария в переменную $commentId
Route::get('/articles/{article}/comments/{comment}', function ($articleId, $commentId) {});
```

### Optional parameters

```php
// по умолчанию для $name используется значение null
Route::get('/articles/{name?}', function ($name = null) {return $name;});

// по умолчанию 'Alex' в $name
Route::get('/articles/{name?}', function ($name = 'Alex') {return $name;});
```

	Для использования опционального параметра необходимо указать значение параметров по умолчанию
### HTTP Verbs

```php
// Опции для определения доступных http методов
Route::options('/articles', function() {});

// Получение данных с сервера
Route::get('/articles', function() {});

// Отправка данных на сервер
Route::post('/articles', function() {});

//  Обновление существующего ресурса
Route::put('/articles', function() {});

// Частичное обновление ресурса
Route::patch('/articles', function() {});

//  Удаление ресурса.
Route::delete('/articles', function() {});

// Ответ на любой тип запроса
Route::any('/articles', function() {});
```

### RESTful Controllers

```php
// Определение ресурсных маршрутов
Route::resource('/articles','ArticleController');

// Частичное определение ресурсных маршрутов
	// only - позволяет определить белый список экшенов, которые доступны по данному роуту
Route::resource('/articles', 'ArticleController',['only' => ['index', 'show']]);
	// except - определяет черный список экшенов, которые недоступны по данному роуту
Route::resource('/articles', 'ArticleController',['except' => ['edit', 'update', 'destroy']]);
```

## Eloquent
### Создание и обновление записей

| Описание | Метод |
|-------------------------------------------------|----------------------------------------------------------------------------------------------|
| Создание новой записи с указанными атрибутами. | `Model::create(array('key' => 'value'))` |
| Создание или обновление записи по атрибутам поиска и новым значениям. | `Model::updateOrCreate(array('search_key' => 'search_value'), array('key' => 'value'))` |
| Заполнение модели атрибутами из массива. | `Model::fill($attributes)` |

### Поиск и выборка данных

| Описание | Метод |
|-------------------------------------------------|----------------------------------------------------------------------------------------------|
| Создание новой записи с атрибутами или поиск существующей, иначе создание. | `Model::firstOrCreate(array('key' => 'value'))` |
| Поиск существующей записи по атрибутам или создание новой, но без сохранения. | `Model::firstOrNew(array('key' => 'value'))`   |
| Поиск записи по идентификатору. | `Model::find(1)` |
| Поиск по двойному первичному ключу. | `Model::find(array('first', 'last'))` |
| Поиск по идентификатору и генерация исключения, если нет совпадений. | `Model::findOrFail(1)` |
| Поиск по двойному первичному ключу и генерация исключения, если нет совпадений. | `Model::findOrFail(array('first', 'last'))` |
| Запрос с условием и возврат результата в виде коллекции. | `Model::where('foo', '=', 'bar')->get()` |
| Запрос с условием и возврат первой записи, удовлетворяющей условиям. | `Model::where('foo', '=', 'bar')->first()` |
| Запрос с динамическим методом на основе атрибута модели. | `Model::whereFoo('bar')->first()` |
| Запрос с условием и генерация исключения, если нет совпадений. | `Model::where('foo', '=', 'bar')->firstOrFail()` |
| Запрос с условием и возврат количества соответствующих записей. | `Model::where('foo', '=', 'bar')->count()` |
| Запрос с проверкой наличия связи и возврат результата. | `Model::whereHas('relation')->get()` |
| Запрос с загрузкой связи и условием на связанный атрибут. | `Model::with('relation')->where('relation.foo', 'bar')->get()` |
| Запрос с условием и удаление соответствующих записей из базы данных. | `Model::where('foo', '=', 'bar')->delete()` |
| Возврат сырого SQL-запроса, сгенерированного запросом Eloquent. | `Model::where('foo', '=', 'bar')->toSql()` |
| Сырой SQL-запрос с параметрами и возврат результата. | `Model::whereRaw('foo = bar and cars = 2', array(20))->get()` |

### Кеширование и работа с соединениями

| Описание | Метод |
|-------------------------------------------------|----------------------------------------------------------------------------------------------------------------|
| Кеширует результат запроса на 5 минут. | `Model::remember(5)->get()` |
| Кеширует результат с указанным именем ключа на 5 минут. | `Model::remember(5, 'cache-key-name')->get()` |
| Кеширует результат с указанным тегом на 5 минут. | `Model::cacheTags('my-tag')->remember(5)->get()` |
| Кеширует результат с несколькими тегами на 5 минут. | `Model::cacheTags(array('my-first-key','my-second-key'))->remember(5)->get()` |
| Выполняет запрос к указанному соединению базы данных. | `Model::on('connection-name')->find(1)` |

### Сортировка и ограничение результатов

| Описание | Метод |
|-------------------------------------------------|--------------------------------------------------------------------------------------------------------|
| Ограничение количества записей. | `Model::all()->take(10)` |
| Пропуск указанного числа записей. | `Model::all()->skip(10)` |
| Сортировка по указанной колонке (по возрастанию). | `Model::orderBy('column')->get()` |
| Сортировка по указанной колонке (по убыванию). | `Model::orderBy('column', 'desc')->get()` |
