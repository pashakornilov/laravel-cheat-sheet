# laravel-cheat-sheet

## Route

	Пример: http://example.com/articles

### Define route

```php
// Регистрация GET-маршрута с использованием замыкания
Route::get('/articles', function(){});

// Регистрация GET-маршрута с использованием контроллера
Route::get('/articles', 'ArticleController@index');
Route::get('/articles', [ArticleController::class, 'index']);
```

### Route Parameter

```php
// Передача числового ID статьи в переменную $id.
Route::get('/articles/{article}', function ($id) {return 'article '. $id;});

// Передача числового ID статьи в переменную $articleId, ID комментария в переменную $commentId
Route::get('/articles/{article}/comments/{comment}', function ($articleId, $commentId) {});
```

### Optional parameters

```php
// по умолчанию для $name используется значение null
Route::get('/articles/{name?}', function ($name = null) {return $name;});

// по умолчанию 'Alex' в $name
Route::get('/articles/{name?}', function ($name = 'Alex') {return $name;});
```

	Для использования опционального параметра необходимо указать значение параметров по умолчанию
### HTTP Verbs

```php
// Опции для определения доступных http методов
Route::options('/articles', function() {});

// Получение данных с сервера
Route::get('/articles', function() {});

// Отправка данных на сервер
Route::post('/articles', function() {});

//  Обновление существующего ресурса
Route::put('/articles', function() {});

// Частичное обновление ресурса
Route::patch('/articles', function() {});

//  Удаление ресурса.
Route::delete('/articles', function() {});

// Ответ на любой тип запроса
Route::any('/articles', function() {});
```

### RESTful Controllers

```php
// Определение ресурсных маршрутов
Route::resource('/articles','ArticleController');

// Частичное определение ресурсных маршрутов
	// only - позволяет определить белый список экшенов, которые доступны по данному роуту
Route::resource('/articles', 'ArticleController',['only' => ['index', 'show']]);
	// except - определяет черный список экшенов, которые недоступны по данному роуту
Route::resource('/articles', 'ArticleController',['except' => ['edit', 'update', 'destroy']]);
```

## Eloquent
### Создание и обновление записей

| Метод                                                         | Создает новую запись в базе данных           атрибутами атрибутами атрибутами с указанными атрибутами.                                                                                 |
|-------------------------------------------------|----------------------------------------------------------------------------------------------|
| `.........................................................................................`| |
| `Model::create(array('key' => 'value'))`        | Создает новую запись в базе данных с указанными атрибутами.                                   |
| `Model::updateOrCreate(array('search_key' => 'search_value'), array('key' => 'value'))` | Создает или обновляет запись, соответствующую атрибутам поиска, и заполняет ее новыми значениями. |
| `Model::fill($attributes)`                      | Заполняет модель атрибутами из массива, остерегайтесь массового присваивания.               |

### Поиск и выборка данных

| Метод                                       | Описание                                                                                     |
|---------------------------------------------|----------------------------------------------------------------------------------------------|
| `.........................................................................................` |
|Поиск||
| `Model::firstOrCreate(array('key' => 'value'))` | Находит первую запись, соответствующую атрибутам, или создает новую, если совпадений нет. |
| `Model::firstOrNew(array('key' => 'value'))` | Находит первую запись, соответствующую атрибутам, или создает новую, но не сохраняет ее.   |
| `Model::find(1)`                            | Находит запись по указанному идентификатору.                                                |
| `Model::find(array('first', 'last'))`        | Поиск с использованием двойного первичного ключа.                                           |
| `Model::findOrFail(1)`                      | Находит запись по указанному идентификатору и генерирует исключение, если совпадений нет. |
| `Model::findOrFail(array('first', 'last'))` | Поиск с использованием двойного первичного ключа и генерация исключения, если совпадений нет. |
|Условия||
| `Model::where('foo', '=', 'bar')->get()`     | Выполняет запрос с условием и возвращает результат в виде коллекции.                        |
| `Model::where('foo', '=', 'bar')->first()`   | Выполняет запрос с условием и возвращает первую запись, удовлетворяющую условиям.            |
| `Model::whereFoo('bar')->first()`             | Выполняет запрос с динамическим методом на основе атрибута модели.                          |
| `Model::where('foo', '=', 'bar')->firstOrFail()` | Выполняет запрос с условием и генерирует исключение, если совпадений нет.                  |
| `Model::where('foo', '=', 'bar')->count()`    | Выполняет запрос с условием и возвращает количество соответствующих записей.                  |
|Связи и условия||
| `Model::whereHas('relation')->get()`               | Выполняет запрос с проверкой наличия связи и возвращает результат.                              |
| `Model::with('relation')->where('relation.foo', 'bar')->get()` | Выполняет запрос с загрузкой связи и условием на связанный атрибут. |
| `Model::where('foo', '=', 'bar')->delete()`        | Выполняет запрос с условием и удаляет соответствующие записи из базы данных.                   |
| `Model::where('foo', '=', 'bar')->toSql()`         | Возвращает сырой SQL-запрос, сгенерированный запросом Eloquent.                                 |
| `Model::whereRaw('foo = bar and cars = 2', array(20))->get()` | Выполняет сырой SQL-запрос с параметрами и возвращает результат.     |

### Кеширование и работа с соединениями

| Метод                                           | Описание                                                                                                       |
|-------------------------------------------------|----------------------------------------------------------------------------------------------------------------|
|`.................................................................................................`|`.........................................................................................`|
| `Model::remember(5)->get()`                      | Кеширует результат запроса на 5 минут.                                                                         |
| `Model::remember(5, 'cache-key-name')->get()`    | Кеширует результат с указанным именем ключа на 5 минут.                                                         |
| `Model::cacheTags('my-tag')->remember(5)->get()` | Кеширует результат с указанным тегом на 5 минут.                                                               |
| `Model::cacheTags(array('my-first-key','my-second-key'))->remember(5)->get()` | Кеширует результат с несколькими тегами на 5 минут.     |
| `Model::on('connection-name')->find(1)`          | Выполняет запрос к указанному соединению базы данных.                                                            |

### Сортировка и ограничение результатов

| Метод                                           | Описание                                                                                               |
|-------------------------------------------------|--------------------------------------------------------------------------------------------------------|
| `Model::all()->take(10)`                         | Ограничивает результат до указанного количества записей.                                             |
| `Model::all()->skip(10)`                         | Пропускает указанное количество записей в результате.                                                |
| `Model::orderBy('column')->get()`                | Сортирует результат по указанной колонке в порядке возрастания.                                      |
| `Model::orderBy('column', 'desc')->get()`        | Сортирует результат по указанной колонке в порядке убывания.                                          |