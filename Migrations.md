## Migrations

### Консольные команды

#### Выполнить миграции:

```console
php artisan migrate
```

#### Создать новый файл миграции:

```shell
php artisan make:migration create_posts_table --create=posts
```

#### Создать новой файл миграции для изменения существующей таблицы:

```shell
# добавление столбца title в таблицу posts

php artisan make:migration add_title_posts_table --table=posts
```

#### Откат последней миграции базы данных:

```shell
php artisan migrate:rollback --step=5
```

#### Очистка базы данных перед миграцией

```shell
php artisan migrate:fresh
```

#### Сброс и повторное выполнение всех миграций:

```shell
php artisan migrate:refresh
```

#### Отмена всех миграций базы данных:

```console
php artisan migrate:reset
```

### Типы данных

| Команда                                | Описание                                                 |
| -------------------------------------- | -------------------------------------------------------- |
|date('created_at');          | Тип данных `DATE` предназначен для хранения даты. Это может быть дата создания записи или другая дата, которая вам необходима. |
|float('price', 8, 2);`     | Тип данных `FLOAT` представляет числа с плавающей запятой. В данном случае, это может быть цена с точностью 8 цифр и масштабом 2 (для копеек). |
|double('temperature', 8, 2);| Тип данных `DOUBLE` также представляет числа с плавающей запятой, но с более высокой точностью, в данном случае - 8 цифр и масштаб 2. |
|decimal('amount', 10, 2);   | Тип данных `DECIMAL` используется для чисел с фиксированной точностью и масштабом. Здесь мы храним сумму с точностью 10 цифр и масштабом 2 (для копеек). |
| integer('votes');`            | Тип данных `INTEGER` предназначен для хранения целых чисел без дробной части, например, количество голосов. |
| tinyInteger('votes');`        | Тип данных `TINYINT` также хранит целые числа, но обычно с меньшим диапазоном значений. |
| ipAddress('visitor');`        | Тип данных `IP-адрес` используется для хранения IP-адресов. |
| json('options');`             | Тип данных `JSON` предназначен для хранения структурированных данных в формате JSON. |
| char('name', 100);`           | Тип данных `CHAR` используется для хранения строк фиксированной длины. Здесь мы храним имя с максимальной длиной 100 символов. |
| string('name', 100);`         | Тип данных `VARCHAR` также предназначен для хранения строк, но с переменной длиной. Максимальная длина имени - 100 символов. |
| text('description');`         | Тип данных `TEXT` используется для хранения текстовых данных переменной длины. |
| longText('description');`     | Тип данных `LONGTEXT` также хранит текст, но с большей максимальной длиной по сравнению с `TEXT`. |
| binary('data');`              | Тип данных `BLOB` (Binary Large Object) предназначен для хранения бинарных данных, таких как изображения или файлы. |
| boolean('confirmed');`        | Тип данных `BOOLEAN` представляет собой булев тип данных, который может иметь значения `true` или `false`. |
| softDeletes();`               | Это команда для добавления мягкого удаления в таблицу. Создает `deleted_at` TIMESTAMP колонку. |
| year('birth_year');`          | Тип данных `YEAR` используется для хранения года. Например, год рождения. |


### Модификаторы

| Описание | Код |
|----------|------------------------------------------|
|***Управление структурой таблицы:***||
| after('username') | Переместить столбец "email" после столбца "username". |
| first(); | Поместить столбец "created_at" в начало таблицы.|
|***Управление столбцами:***||
| increments('id'); | Установить столбец "id" как автоинкрементирующийся (первичный ключ). |
| charset('utf8mb4'); | Указать набор символов "utf8mb4" для столбца "content". |
| collation('utf8mb4_unicode_ci');| Указать каталожное сравнение "utf8mb4_unicode_ci" для столбца "name". |
| comment('Описание столбца');| Добавить комментарий к столбцу "description". |
| default('active');| Установить значение "по умолчанию" для столбца "status". |
| invisible();| Сделать столбец "secret_key" невидимым для запросов SELECT * |
| nullable();| Разрешить вставку NULL-значений в столбец "notes". |
| storedAs('price * quantity');| Создать вычисляемый столбец "total_price" на основе выражения. |
|unsigned();| Установить INTEGER-столбцы, чтобы использовать CURRENT_TIMESTAMP как значение "по умолчанию" |
| useCurrentOnUpdate();| Установить TIMESTAMP-столбцы, чтобы использовать CURRENT_TIMESTAMP при обновлении записи |
| generatedAs('nextval(\'my_sequence\'));| Создать столбец с автоинкрементом с указанными параметрами последовательности |
| always();| Определить приоритет значений последовательности над входными данными для столбца с автоинкрементом |
| isGeometry();| Установить тип пространственного столбца "location" как "geometry" |

### Индексы

Без проблем, вот таблица без пустых строк и символа " ` ":

| Описание | Пример |
|----------|--------|
| $table->primary(['id', 'parent_id']); | Добавить составной первичный ключ на столбцы "id" и "parent_id" |
| $table->primary('id'); | Добавить первичный ключ на столбец "id" |
| $table->unique('email'); | Добавить уникальный индекс на столбец "email" |
| $table->index('state'); | Добавить обычный индекс на столбец "state" |
| $table->fullText('body'); | Добавить полнотекстовый индекс на столбец "body" |
| $table->spatialIndex('location'); | Добавить пространственный индекс на столбец "location" |
### Рекомендации

#### Используйте осмысленные имена миграций

```php
// Эта миграция создает таблицу для хранения информации о пользователях
CreateUsersTable
```


#### Список популярных префиксов для именования миграций

| Префикс | Назначение | Пример |
|-|-|-|  
| create_ | Создание таблицы | create_users_table |
| add_ | Добавление столбца |  add_votes_column |
| remove_ | Удаление столбца | remove_deprecated_columns |
| drop_ | Удаление таблицы | drop_temp_table |
| alter_ | Изменение столбца | alter_user_password_column |
| rename_ | Переименование таблицы/столбца | rename_table_users_to_profiles |
| optimize_ | Оптимизация таблицы | optimize_users_table |
| modify_ | Модификация таблицы | modify_posts_table_charset |
| populate_ | Заполнение таблицы | populate_posts_table |
| reset_ | Сброс auto_increment | reset_auto_increment_id |
| restore_ | Восстановление из backup | restore_posts_from_backup |


#### Добавляйте комментарии в миграции  

```php
/**
 * Add votes column to users table.
 */ 
public function up()
{
  Schema::table('users', function (Blueprint $table) {
    $table->integer('votes');
  });
}
```


#### Разделяйте большие миграции 

Если миграция получается слишком большой, разделите её на несколько отдельных миграций по логическим блокам.


#### Реализуйте `down()` противоположно `up()`

Метод `down()` должен действовать противоположно `up()`:

```php 
public function up()
{
  Schema::create('users');
}

public function down()
{
  Schema::drop('users');
}
```


#### Добавляйте в .gitignore сгенерированные миграции

```
/database/migrations/*
!/database/migrations/README.md
```

Это проигнорирует все миграции, кроме README.


#### Тестируйте откаты перед продакшеном

Перед применением миграций на продакшене протестируйте откаты:

```
php artisan migrate
php artisan migrate:rollback
```


#### Используйте seeds после миграций 

Seeds позволяют заполнить БД тестовыми данными. Используйте после миграций:

```
php artisan migrate
php artisan db:seed
```


#### Следите за порядком миграций

Следите, чтобы миграции выполнялись в правильном порядке без ошибок зависимостей.


#### Не изменяйте применённые миграции

Не изменяйте уже применённые на продакшене миграции. Создавайте новые миграции для изменений.